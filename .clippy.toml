# Clippy configuration for Minerva - Phase 6
# Enforces strict code quality standards per engineering_standards.md
# Reference: https://rust-lang.github.io/rust-clippy/master/index.html

# =============================================================================
# FUNCTION SIGNATURE RULES (Complexity ≤ 3)
# =============================================================================

# Maximum 3 arguments per function - enforces dependency injection pattern
# Functions with more parameters should consolidate into objects/structs
# Relates to: Single Responsibility, Dependency Injection, Testability
too-many-arguments-threshold = 3

# =============================================================================
# COMPLEXITY THRESHOLDS (Keep functions simple and understandable)
# =============================================================================

# Cognitive complexity per function - STRICT ENFORCEMENT
# Measures how hard a function is to understand
# Lower = simpler = easier to test and maintain
# 
# Cyclomatic Complexity (M) ≤ 3 is our standard:
#   M ≤ 3 maps to cognitive complexity ≤ 6-8
#   We enforce cognitive-complexity-threshold = 6 to ensure M ≤ 3
#
# Cognitive complexity measures:
#   - Each if/match branch: +1
#   - Nested branching: +1 per nesting level
#   - Loops: +1 each
#   - Exception handlers: +1
#
# Setting to 6 ensures tight control on function complexity
# Run: cargo clippy -- -W clippy::cognitive-complexity
cognitive-complexity-threshold = 6

# Type complexity threshold (avoid overly complex types)
# Prevents type-level obfuscation and makes code more readable
type-complexity-threshold = 250

# =============================================================================
# TEST CODE ALLOWANCES
# =============================================================================

# Allow expect() in test code without warnings
# Tests need to panic on invalid conditions
allow-expect-in-tests = true

# Allow unwrap() in test code without warnings
# Tests can be more lenient with error handling
allow-unwrap-in-tests = true

# =============================================================================
# DOCUMENTATION REQUIREMENTS
# =============================================================================

# Require documentation for public items
# Helps maintain clarity and enables IDE documentation features
# Note: Also use `#![warn(missing_docs)]` in lib.rs for enforcement

# =============================================================================
# SIZE WARNINGS
# =============================================================================

# Maximum size of objects (in bytes) that's ok to stack allocate
# Larger objects should use Box or other heap allocation
# This prevents stack overflows with large local variables
too-large-for-stack = 200

# =============================================================================
# NAMING CONVENTIONS
# =============================================================================

# Single char names are generally discouraged except in very limited contexts
# (e.g., loop variables, mathematical operations, single-letter generics)
# Higher threshold keeps linting focused on critical cases
single-char-binding-names-threshold = 4

# =============================================================================
# ASYNC/AWAIT SAFETY
# =============================================================================

# Types that should not be held across await points
# Includes non-async-aware synchronization primitives
# Add to this list if you have custom types that shouldn't cross await boundaries
await-holding-invalid-types = [
    # Example: "std::sync::Mutex" would go here if not already detected
]

# =============================================================================
# SAFETY & CORRECTNESS
# =============================================================================

# These lints are automatically enforced by Clippy's default deny rules:
# - absurd_extreme_comparisons (comparing with type min/max)
# - almost_swapped (failed swap patterns)
# - async_yields_async (missing await)
# - bad_bit_mask (impossible bit patterns)
# - bool_comparison (comparing bool with literals)

# =============================================================================
# PERFORMANCE LINTS (warn by default, upgrade to deny in CI)
# =============================================================================

# These are automatically detected:
# - borrowed_box (use &T instead of &Box<T>)
# - box_collection (don't box collections)
# - box_default (use Box::default())
# - boxed_local (don't use Box for local variables)

# =============================================================================
# STYLE ENFORCEMENT
# =============================================================================

# Blocks in conditions make code hard to read
# (if { true } { ... } should be if true { ... })

# Assignments in conditions are error-prone
# (if x = 5 { ... } likely meant if x == 5 { ... })

# =============================================================================
# ENGINEERING STANDARDS ALIGNMENT - PHASE 11+ UNIVERSAL COMPLIANCE
# =============================================================================

# These settings align with the standards defined in docs/PHASE_11_PLUS_COMPLIANCE.md:
#
# Cyclomatic Complexity (M ≤ 3):
#   ✅ cognitive-complexity-threshold = 6 (enforces M ≤ 3)
#   ✅ type-complexity-threshold = 250 (prevent obfuscation)
#   ✅ NO EXCEPTIONS - applied to ALL code including inference/
#   ✅ Run: cargo clippy -- -W clippy::cognitive-complexity
#
# Parameter Count (≤ 3):
#   ✅ too-many-arguments-threshold = 3 (enforces DI pattern)
#   ✅ Automatically enforced via: cargo clippy --all-targets -- -D warnings
#
# Function Size (≤ 25 lines):
#   ✅ Enforced via code review (primary check)
#   ✅ Use grep to find long functions: grep -n 'fn ' src-tauri/src/**/*.rs
#
# File Size (≤ 150 lines):
#   ✅ Enforced via CI script: ./scripts/check-all-standards.sh
#   ✅ ALL code enforced (NO EXCEPTIONS for inference/)
#   ✅ ALL modules must comply (api, bin, cli, inference, etc)
#   ✅ Pre-commit hook prevents non-compliant commits
#
# Code Quality:
#   ✅ allow-expect-in-tests = true (allows panic assertions in tests)
#   ✅ allow-unwrap-in-tests = true (allows test ergonomics)
#   ✅ All warnings treated as errors: -- -D warnings
#
# =============================================================================
# USAGE - ENFORCEMENT COMMANDS
# =============================================================================

# This file is automatically read from the workspace root.

# Run clippy with all standards enforced:
#   cargo clippy --all-targets --all-features -- -D warnings
#
# Enforce parameter count (≤ 3):
#   cargo clippy --all-targets -- -D clippy::too-many-arguments
#
# Enforce cyclomatic complexity (M ≤ 3, cognitive ≤ 6):
#   cargo clippy -- -W clippy::cognitive-complexity
#
# Check all standards via CI script:
#   ./scripts/check-all-standards.sh
#   pnpm lint
#
# Full local pre-commit verification:
#   ./.git/hooks/pre-commit
#
# Current violations:
#   Run: find src-tauri/src -name "*.rs" -exec wc -l {} \; | sort -rn | head -20
#   These files must be refactored to ≤ 150 lines
